<!DOCTYPE html>
<html>
<head>
    <title>Return Asset</title>
    <script>
        // Runs when the dialog is loaded
        window.onload = function () {
            const { recordId, assetName } = parseDialogData();
            displayDialogData(recordId, assetName);
        };

        /**
         * Parses the record ID and asset name from the query string.
         * @returns {Object} An object containing recordId and assetName.
         */
        function parseDialogData() {
            const params = new URLSearchParams(window.location.search);
            const data = params.get("data");
            const parsedData = JSON.parse(data || "{}");
            return {
                recordId: parsedData.recordId || "Unknown",
                assetName: parsedData.assetName || "Unknown"
            };
        }

        /**
         * Displays the record ID and asset name in the HTML.
         * @param {string} recordId - The record ID to display.
         * @param {string} assetName - The asset name to display.
         */
        function displayDialogData(recordId, assetName) {
            document.getElementById("recordId").innerText = `Record ID: ${recordId}`;
            document.getElementById("assetName").innerText = `Asset Name: ${assetName}`;
        }

        /**
         * Handles the submission of the form.
         */
        function handleSubmit() {
            const selectedStatus = getSelectedStatus();

            if (!selectedStatus) {
                alert("Please select a status!");
                return;
            }

            const { recordId, assetName } = parseDialogData();
            returnResultToParent(selectedStatus, recordId, assetName);
        }

        /**
         * Retrieves the selected status from the dropdown.
         * @returns {string} The selected status value.
         */
        function getSelectedStatus() {
            return document.getElementById("statusDropdown").value;
        }

        /**
         * Passes the selected status, record ID, and asset name back to the parent and closes the dialog.
         * @param {string} selectedStatus - The selected status.
         * @param {string} recordId - The record ID to return.
         * @param {string} assetName - The asset name to return.
         */
        function returnResultToParent(selectedStatus, recordId, assetName) {
            window.returnValue = {
                selectedStatus: selectedStatus,
                recordId: recordId,
                assetName: assetName
            };
            window.close();
        }

        /**
         * Closes the dialog without returning any value.
         */
        function handleCancel() {
            window.returnValue = null;
            window.close();
        }
    </script>
</head>
<body>
    <h1>Return Asset</h1>
    <p id="recordId">Loading Record ID...</p>
    <p id="assetName">Loading Asset Name...</p>
    <form id="statusForm" onsubmit="handleSubmit(); return false;">
        <label for="statusDropdown">Select Return Status:</label>
        <select id="statusDropdown" required>
            <option value="">-- Select Status --</option>
            <option value="795540000">üü¢ Operational</option>
            <option value="795540001">üü° Requires Attention</option>
            <option value="795540002">üî¥ Requires Repair</option>
            <option value="795540003">‚õîÔ∏è Retired/Sold</option>
        </select>
        <br><br>
        <input type="submit" value="Submit">
        <button type="button" onclick="handleCancel()">Cancel</button>
    </form>
</body>
</html>
