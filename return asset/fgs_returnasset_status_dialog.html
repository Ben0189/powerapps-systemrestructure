<!DOCTYPE html>
<html>
<head>
    <title>Return Asset</title>
    <style>
        /* Embedded CSS for styling */
        body {
            font-family: Arial, sans-serif;
            background-color: #f9f9f9;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        .container {
            background-color: #ffffff;
            padding: 20px 30px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            max-width: 400px;
            width: 100%;
        }

        h1 {
            font-size: 1.5rem;
            color: #333333;
            margin-bottom: 20px;
            text-align: center;
        }

        p {
            margin: 10px 0;
            font-size: 1rem;
            color: #555555;
        }

        label {
            font-size: 1rem;
            color: #333333;
        }

        select {
            width: 100%;
            padding: 10px;
            font-size: 1rem;
            border: 1px solid #cccccc;
            border-radius: 5px;
            margin-top: 5px;
            margin-bottom: 20px;
            background-color: #ffffff;
        }

        select:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 5px rgba(0, 123, 255, 0.5);
        }

        input[type="submit"],
        button {
            padding: 10px 15px;
            font-size: 1rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 10px;
        }

        input[type="submit"] {
            background-color: #007bff;
            color: #ffffff;
            transition: background-color 0.3s;
        }

        input[type="submit"]:hover {
            background-color: #0056b3;
        }

        button {
            background-color: #cccccc;
            color: #333333;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #999999;
        }

    </style>
</head>
<body>
    <div class="container">
        <h1>Return Asset</h1>
        <p id="assetName">Loading Asset Name...</p>
        <form id="statusForm" onsubmit="handleSubmit(); return false;">
            <label for="statusDropdown">Select Return Status:</label>
            <select id="statusDropdown" required onchange="toggleCommentBox()">
                <option value="">-- Select Status --</option>
                <option value="795540000">üü¢ Operational</option>
                <option value="795540001">üü° Requires Attention</option>
                <option value="795540002">üî¥ Requires Repair</option>
                <option value="795540003">‚õîÔ∏è Retired/Sold</option>
            </select>
            
            <div id="commentBox" style="display: none; margin-top: 10px;">
                <label for="statusNote">Return Status Comments:</label>
                <textarea id="statusNote" placeholder="Enter comments (optional)" rows="3" style="width: 100%; margin-bottom: 20px;"></textarea>
            </div>

            <input type="submit" value="Submit">
            <button type="button" onclick="handleCancel()">Cancel</button>
        </form>
    </div>

    <script>
        // Runs when the dialog is loaded
        window.onload = function () {
            const { assetName } = parseDialogData();
            displayDialogData(assetName);
        };

        /**
         * Parses the asset name from the query string.
         * @returns {Object} An object containing assetName.
         */
        function parseDialogData() {
            const params = new URLSearchParams(window.location.search);
            const data = params.get("data");
            const parsedData = JSON.parse(data || "{}");
            return {
                assetName: parsedData.assetName || "Unknown"
            };
        }

        /**
         * Displays the asset name in the HTML.
         * @param {string} assetName - The asset name to display.
         */
        function displayDialogData(assetName) {
            document.getElementById("assetName").innerText = `Asset Name: ${assetName}`;
        }

        /**
         * Handles the submission of the form.
         */
        function handleSubmit() {
            const selectedStatus = getSelectedStatus();
            const statusNote = getStatusNote();

            if (!selectedStatus) {
                alert("Please select a status!");
                return;
            }

            const { assetName } = parseDialogData();
            returnResultToParent(selectedStatus, assetName, statusNote);
        }

        /**
         * Retrieves the selected status from the dropdown.
         * @returns {string} The selected status value.
         */
        function getSelectedStatus() {
            return document.getElementById("statusDropdown").value;
        }

        /**
         * Retrieves the return status comments from the text area.
         * @returns {string} The comments entered by the user.
         */
        function getStatusNote() {
            return document.getElementById("statusNote").value.trim();
        }

        /**
         * Passes the selected status and asset name back to the parent and closes the dialog.
         * @param {string} selectedStatus - The selected status.
         * @param {string} assetName - The asset name to return.
         */
        function returnResultToParent(selectedStatus, assetName, statusNote) {
            window.returnValue = {
                selectedStatus: selectedStatus,
                assetName: assetName,
                statusNote: statusNote
            };
            window.close();
        }

        /**
         * Closes the dialog without returning any value.
         */
        function handleCancel() {
            window.returnValue = null;
            window.close();
        }

        /**
         * Toggles the visibility of the comment box based on the selected status.
         */
        function toggleCommentBox() {
            const statusDropdown = document.getElementById("statusDropdown");
            const commentBox = document.getElementById("commentBox");

            // Show the comment box if the selected status is not "Operational"
            if (statusDropdown.value !== "795540000") {
                commentBox.style.display = "block";
            } else {
                commentBox.style.display = "none";
            }
        }

    </script>
</body>
</html>
